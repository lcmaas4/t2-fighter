<!DOCTYPE html>

<html>

<style>
canvas {
	border:2px solid red;
}
#canvaswrap{
	position: relative;
}
#overlay{
	position: absolute;
	left: 100px;
	top: 300px;
	height: 100px;
	width: 200px;
	background-color;
	font: Arial;
	font-size: 30px;
	color: white;
	font-weight: bold;
}
#overlay2{
	position: absolute;
	left: px;
	top: 300px;
	height: 100px;
	width: 200px;
	font: Arial;
	font-size: 30px;
	color: white;
	font-weight: bold;
}
</style>

<body>
	<div id='canvaswrap'>
		<canvas id="canvasID" width=1200 height=500> </canvas>
		<div id= 'overlay' onclick='rematch()'></div>
		<div id = 'overlay2' onclick='backToSelect()'></div>
	</div>
<script>
	var canvas = document.getElementById("canvasID");
	var context = canvas.getContext("2d");
	var stateController = 0;
	var hh = 100;
	var ww = 100;
	var loadPhoto = new Image();
	var playerL = null;
	var playerR = null;
	var lX = 100;
	var rX = canvas.width-200;
	loadPhoto.width = ww;
	loadPhoto.height = hh;
	loadPhoto.src = "./fighter-stuff/kai.png";
	var samokai = new Image();
	var background = new Image();
	background.src = "./fighter-stuff/babyblue.jpg";
	samokai.src = "./fighter-stuff/normalSamo_standing_left.png";
	document.addEventListener("keydown", affirmKeyDown);
	
	
	setInterval(controlState,100);
	
	function controlState(){
		if(stateController == 0){
			startScreen();
			if(ww <= 300){
				bigImage();
			}
			else{
				showText();
			}
		}
		else if(stateController == 1){
			characterSelectL();
			canvas.addEventListener("click",handleClickL);
		}
		else if(stateController == 2){
			characterSelectR();
			canvas.addEventListener("click",handleClickR);
		}
		else if(stateController == 3){
			playGame();
			document.addEventListener("keydown", gameKeyPressed);
			document.addEventListener("keyup", gameKeyReleased);
		}
		else if(stateController == 4){
			endGame();
		}
	}
	
	function affirmKeyDown(event){
		stateController++;
		document.removeEventListener("keydown",affirmKeyDown);
		console.log("peen");
	}
	
	function startScreen(){
		context.drawImage(loadPhoto, (canvas.width/2-ww/2), (canvas.height/2-hh/2), hh, ww);
	}
	
	function bigImage(){
		hh+=2;
		ww+=2;
	}
	
	function showText(){
		context.font = "50px Arial";
		context.fillText("SAMO SHOWDOWN", canvas.width/2-250, canvas.height/2 + canvas.height/3 + 25);
		context.font = "20px Arial";
		context.fillText("Press any key to continue.", canvas.width/2-250, canvas.height/2 + canvas.height/3 + 50);
	}
	
	function characterSelectL(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.font = "30px Arial";
		context.fillText("CHARACTER SELECT (P1)", canvas.width/2-175, 50);
		context.drawImage(samokai, 50,100,75,150);
		context.fillText("SAMOKAI", 50, 100+150+30);
	}
	
	function characterSelectR(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.font = "30px Arial";
		context.fillText("CHARACTER SELECT (P2)", canvas.width/2-175, 50);
		context.drawImage(samokai, 50,100,75,150);
		context.fillText("SAMOKAI", 50, 100+150+30);
	}
	
	function handleClickL(event){
		//console.log(event.x);
		if(event.x>50 && event.x <210){
			selectKaiL();
		}
	}	
	
	function handleClickR(event){
		//console.log(event.x);
		if(event.x>50 && event.x <210){
			selectKaiR();
		}	
	}
	
	function selectKaiL(){
		playerL = new LeftSamokai();
		console.log(playerL);
		canvas.removeEventListener("click", handleClickL);
		stateController++;
	}
	
	function selectKaiR(){
		playerR = new RightSamokai();
		console.log(playerR);
		canvas.removeEventListener("click", handleClickR);
		stateController++;
	}
	
	
	function drawBackground(){
		context.clearRect(0,0,canvas.width,canvas.height);
		context.drawImage(background, 0 ,0 ,1200,600);
	}
	
	function checkWin(){
		if(playerL.health <= 0){
			document.removeEventListener("keydown", gameKeyPressed);
			document.removeEventListener("keyup", gameKeyReleased);
			document.getElementById('overlay').style.backgroundColor = 'red';
			document.getElementById('overlay2').style.backgroundColor = '#FF0000';
			//console.log('gothere');
			document.getElementById('overlay').innerHTML = 'REMATCH';
			document.getElementById('overlay2').innerHTML = 'CHARACTER SELECT';
			stateController++;
			playerR.win = true;
			}
		else if(playerR.health <= 0){
			stateController++;
			playerL.win = true;
			document.getElementById('overlay').style.backgroundColor = 'red';
			document.getElementById('overlay2').style.backgroundColor = '#FF0000';
			//console.log('gothere');
			document.getElementById('overlay').innerHTML = 'REMATCH';
			document.getElementById('overlay2').innerHTML = 'CHARACTER SELECT';
			document.removeEventListener("keydown", gameKeyPressed);
			document.removeEventListener("keyup", gameKeyReleased);
			document.getElementById('overlay:hover').style.backgroundColor = 'green';
			document.getElementById('overlay2:hover').style.backgroundColor = 'green';
		}
	}
	
	function rematch(){
		playerL.health = 100;
		playerR.health = 100;
		stateController = 3;
		playerL.x = 100;
		playerR.x = 1000;
		document.getElementById('overlay').style.backgroundColor = '';
		document.getElementById('overlay2').style.backgroundColor = '';
		document.getElementById('overlay').innerHTML = '';
		document.getElementById('overlay2').innerHTML = '';
	}
	
	function backToSelect(){
		stateController = 1;
		document.getElementById('overlay').style.backgroundColor = '';
		document.getElementById('overlay2').style.backgroundColor = '';
		document.getElementById('overlay').innerHTML = '';
		document.getElementById('overlay2').innerHTML = '';
	}
	
	
	function setLPunchTrue(){
		playerL.canPunch = true;
	}
	
	function setLKickTrue(){
		playerL.canKick = true;
	}
	function setRPunchTrue(){
		playerR.canPunch = true;
	}
	
	function setRKickTrue(){
		playerR.canKick = true;
	}
	
	function playGame(){
		drawBackground();
		drawCharacters();
		drawHealthBars();
		checkCollisions();
		checkWin();

				
	}
	
	
	function gameKeyPressed(event){
		if(event.key == 'w' || (event.key == 'a' && playerL.movingLeft == false)|| event.key == 's' || (event.key == 'd' && playerL.movingRight == false)){
			playerL.checkMove(event);
		}
		if(event.keyCode>=37 && event.keyCode <= 40){
			playerR.checkMove(event);
		}
		if(event.key == 'z' || event.key == 'x' || event.key == 'c'){
			playerL.checkHit(event);
		}
		if(event.key == 'm' || event.key == 'n' || event.key == 'b'){
			playerR.checkHit(event);
		}
			
			
	}
	
	function gameKeyReleased(event){
		if((event.key == 'a' && playerL.movingLeft == true)|| event.key == 's' || (event.key == 'd' && playerL.movingRight == true)){
			playerL.stopMove(event);
		}
		if(event.keyCode>=37 && event.keyCode <= 40){
			playerR.stopMove(event);
		}
		if(event.key == 'x'){
			playerL.isPunching = false;
		}
		if(event.key == 'c'){
			playerL.isKicking = false;
		}
		if(event.key == 'n'){
			playerR.isPunching = false;
		}
		if(event.key == 'm'){
			playerR.isKicking = false;
		}
	}
	
	
	function drawCharacters(){
		if(playerL.name == samokai){
			playerL.draw();
			playerL.move();
		}
		if(playerR.name == samokai){
			playerR.draw();
			playerR.move();
		}
	}
	
	function checkCollisions(){
		if(playerL.x + playerL.width >= playerR.x){
			if(playerL.movingRight){
				playerL.x -= playerL.speed;
			}
			if(playerR.movingLeft){
				playerR.x += playerR.speed;
			}
		}
		if(playerL.x <= 0){
			playerL.x += playerL.speed;
		}
		if(playerR.x + playerR.width >= canvas.width){
			playerR.x -= playerL.speed;
		}
	}
	
	function drawHealthBars(){
		context.fillRect(25,25,150,50);
		context.fillRect(canvas.width-225,25,150,50);
		context.fillStyle = "#00FF00";
		context.fillRect(50,35,playerL.health,30);
		context.fillRect(canvas.width-200,35,playerR.health,30);
		context.fillStyle="#FF0000";
		context.fillRect(50+playerL.health,35,100-playerL.health,30);
		context.fillRect(canvas.width-200+playerR.health,35,100-playerR.health,30);
		context.fillStyle = "#000000";
		
	}
	
	function endGame(){
		if(playerL.win){
			drawBackground();
			context.font = "100px Arial";
			context.fillStyle = "FF0000";
			context.fillText("LEFT PLAYER WIN", 150, canvas.height/2);
			context.font = '50px Arial'
			//context.fillText("Press R for a rematch.");
			//context.fillText("Press S to reselect characters.");
		}
		else if(playerR.win){
			drawBackground();
			context.font = "100px Arial";
			context.fillStyle = "FF0000";
			context.fillText("RIGHT PLAYER WIN", 150, canvas.height/2);
		}
	}
	
	
	function RightSamokai(){
		this.name = samokai;
		this.x = 1000;
		this.y = 200;
		this.width = 120;
		this.height = 250;
		this.movingRight = false;
		this.movingLeft = false;
		this.isJumping = false;
		this.peaked = false;
		this.win = false;
		this.canPunch = true;
		this.canKick = true;
		this.isPunching = false;
		this.isKicking = false;
		this.maxJumpHeight = 100;
		this.speed = 14;
		this.health = 20;
		this.standing = new Image();
		this.standing.src = "./fighter-stuff/normalSamo_standing_right.png";
		this.walking = new Image();
		this.walking.src = "./fighter-stuff/normalSamo_walking_right.png";
		this.numbImagesWalking = 4;
		this.walkingWidth = 120;
		this.currentImage = 0;
		this.subImageWidth = 375;
		this.subImageHeight = 800;
		this.currentSpriteSheet = this.standing;
		
		this.draw = function(){
			var ssX = 0;
			
			if(this.movingRight || this.movingLeft) {
				this.currentSpriteSheet = this.walking;
				this.width = this.walkingWidth;
				ssX = this.currentImage * this.subImageWidth;
			}
			
			else {
				this.currentSpriteSheet = this.standing;
				this.width = 120;
			}
			
			context.drawImage(this.currentSpriteSheet, ssX , 0, this.subImageWidth, this.subImageHeight, this.x, this.y, this.width, this.height);
			this.currentImage++;
			this.currentImage %= this.numbImagesWalking;
		}
		
		this.move = function(){
			if(this.movingRight == true){
				this.x += this.speed;
				console.log('moving r');
			}
			if(this.movingLeft == true){
				this.x -= this.speed;
			}
			if(this.isJumping == true){
				this.jump();
			}
		}
		
		this.checkMove = function(event){
			if(event.keyCode == 37 && this.movingLeft == false){
				this.movingLeft = true;
				console.log("left start");
				//document.removeEventListener
				
			}
			if(event.keyCode == 39 && this.movingRight == false){
				this.movingRight = true;
				console.log("right start");
				//console.log(this.x);
			}
			if(event.keyCode == 38 && this.isJumping == false){
				this.isJumping = true;
				console.log("yump");
			}
			if(event.key == 's'){
				//playerLBlock();
			}
		}
		
		this.jump = function(){
			
			if(this.peaked && this.y > 200){
				this.isJumping = false;
				this.y = 200;
				this.peaked = false;
			}
			
			if(this.y <= 200-this.maxJumpHeight){
				this.peaked = true;
			}
			this.doJump();
			console.log("yumping");
		}
		
		this.doJump = function(){
			if(this.isJumping && !this.peaked){
				this.y -= 35;
			}
			else if(this.isJumping && this.peaked){
				this.y += 50;
			}
		} 
		
	
	
		this.stopMove = function(event){
			if(event.keyCode == 37 && this.movingLeft == true){
				this.movingLeft = false;
				console.log("left stop @ " + this.x);
			}
			if(event.keyCode == 39 && this.movingRight == true){
				this.movingRight = false;
				console.log("right stop @ " + this.x);
			}
		}
		
		this.checkHit = function(event){
			if(event.key == 'n' && this.canPunch && !this.isKicking){
				setTimeout(setRPunchTrue, 1000);
				this.punch();
				this.isPunching = true;
				//console.log(this.canPunch);
			}
			else if(event.key == 'm' && this.canKick && !this.isPunching){
				setTimeout(setRKickTrue, 2000);
				this.kick();
				this.isKicking = true;
			}
			else if(event.key == 'z'){
				this.special;
			}
	}
	
		this.punch = function(){
			if(Math.abs((playerL.y + playerL.subImageHeight/2) - (playerR.y + playerR.subImageHeight/2)) <= (playerR.subImageHeight + playerL.subImageHeight)/2 &&
		   (playerR.x - playerL.x - playerL.width) <= 50 && this.canPunch && this.isKicking == false){
				playerL.health -= 5;
				this.canPunch = false;
				this.isPunching = false;
				
		}
	
	}
	
		this.kick = function(){
			if(Math.abs((playerL.y + playerL.subImageHeight/2) - (playerR.y + playerR.subImageHeight/2)) <= (playerR.subImageHeight + playerL.subImageHeight)/2 &&
		   (playerR.x - playerL.x - playerL.width) <= 100 && this.canKick && this.isPunching == false){
				playerL.health -= 10;
				this.canKick = false;
				this.isKicking = false;
		}
	}
	}
	
	
	function LeftSamokai(){
		this.name = samokai;
		this.x = 100;
		this.y = 200;
		this.width = 120;
		this.height = 250;
		this.movingRight = false;
		this.movingLeft = false;
		this.isJumping = false;
		this.peaked = false;
		this.win = false;
		this.canPunch = true;
		this.canKick = true;
		this.isPunching = false;
		this.isKicking = false;
		this.maxJumpHeight = 100;
		this.speed = 14;
		this.health = 20;
		this.standing = new Image();
		this.standing.src = "./fighter-stuff/normalSamo_standing_left.png";
		this.walking = new Image();
		this.walking.src = "./fighter-stuff/normalSamo_walking_left.png";
		this.numbImagesWalking = 4;
		this.walkingWidth = 120;
		this.currentImage = 0;
		this.subImageWidth = 375;
		this.subImageHeight = 800;
		this.currentSpriteSheet = this.standing;
		
		this.draw = function(){
			var ssX = 0;
		
			if(this.movingRight || this.movingLeft) {
				this.currentSpriteSheet = this.walking;
				this.width = this.walkingWidth;
				ssX = this.currentImage * this.subImageWidth;
			}
			
			else {
				this.currentSpriteSheet = this.standing;
				this.width = 120;
			}
			
			context.drawImage(this.currentSpriteSheet, ssX , 0, this.subImageWidth, this.subImageHeight, this.x, this.y, this.width, this.height);
			this.currentImage++;
			this.currentImage %= this.numbImagesWalking;
		}
		
		this.move = function(){
			if(this.movingRight == true){
				this.x += this.speed;
				console.log('moving r');
			}
			if(this.movingLeft == true){
				this.x -= this.speed;
			}
			if(this.isJumping){
				this.jump();
			}
		}
		
		this.jump = function(){
			
			if(this.peaked && this.y > 200){
				this.isJumping = false;
				this.y = 200;
				this.peaked = false;
			}
			
			if(this.y <= 200-this.maxJumpHeight){
				this.peaked = true;
			}
			this.doJump();
			console.log("yumping");
		}
		
		this.doJump = function(){
			if(this.isJumping && !this.peaked){
				this.y -= 40;
			}
			else if(this.isJumping && this.peaked){
				this.y += 50;
			}
		} 
		
		this.checkMove = function(event){
			if(event.key == 'a' && this.movingLeft == false){
				this.movingLeft = true;
				//console.log("left start");
				//document.removeEventListener
				
			}
			if(event.key == 'd' && this.movingRight == false){
				this.movingRight = true;
				//console.log("right start");
				//console.log(this.x);
			}
			if(event.key == 'w' && !this.isJumping){
				this.isJumping = true;	
				//console.log("yump");
				}
			
			if(event.key == 's'){
				//playerLBlock();
			}
		}
		
	
	
	this.stopMove = function(event){
		if(event.key == 'a' && this.movingLeft == true){
			this.movingLeft = false;
			console.log("left stop @ " + this.x);
		}
		if(event.key == 'd' && this.movingRight == true){
			this.movingRight = false;
			console.log("right stop @ " + this.x);
		}
	}
	
	this.checkHit = function(event){
		if(event.key == 'x' && this.canPunch && !this.isKicking){
			setTimeout(setLPunchTrue, 1000);
			this.punch();
			this.isPunching = true;
			//console.log(this.canPunch);
		}
		else if(event.key == 'c' && this.canKick && !this.isPunching){
			setTimeout(setLKickTrue, 2000);
			this.kick();
			this.isKicking = true;
		}
		else if(event.key == 'z'){
			this.special;
		}
	}
	
	this.punch = function(){
		if(Math.abs((playerL.y + playerL.subImageHeight/2) - (playerR.y + playerR.subImageHeight/2)) <= (playerR.subImageHeight + playerL.subImageHeight)/2 &&
		   (playerR.x - playerL.x - playerL.width) <= 50 && this.canPunch && this.isKicking == false){
				playerR.health -= 5;
				this.canPunch = false;
				this.isPunching = false;
				
		}
	
	}
	
	this.kick = function(){
		if(Math.abs((playerL.y + playerL.subImageHeight/2) - (playerR.y + playerR.subImageHeight/2)) <= (playerR.subImageHeight + playerL.subImageHeight)/2 &&
		   (playerR.x - playerL.x - playerL.width) <= 100 && this.canKick && this.isPunching == false){
				playerR.health -= 10;
				this.canKick = false;
				this.isKicking = false;
		}
	}
	
	
	}
		
	
	
	
</script>